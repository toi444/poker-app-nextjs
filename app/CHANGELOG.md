# 変更履歴 - 石高トーナメント

すべての重要な変更はこのファイルに記録されます。

## フォーマット

このプロジェクトは [Semantic Versioning](https://semver.org/) に従います。

- **Added**: 新機能
- **Changed**: 既存機能の変更
- **Deprecated**: 今後削除予定の機能
- **Removed**: 削除された機能
- **Fixed**: バグ修正
- **Security**: セキュリティ関連

---

## [Unreleased] - 実装予定

### Added
- 弐之陣「城攻め」の実装
- 参之陣「一騎討ち」の実装
- 管理者ダッシュボード
- リアルタイム通知機能
- プレイヤー検索機能

### Changed
- パフォーマンス最適化

---

## [0.3.0] - 2025-10-14

### Added
- 🎮 **石高トーナメント 壱之陣「合戦」UI実装**
  - Phase 1: 出陣演出（スマホ対応）
  - Phase 2: 敵軍の攻撃（スマホ対応、兵種別色分け）
  - Phase 3: 味方の反撃（スマホ対応、戦車隊15%、優勢・互角・劣勢表示）
  - Phase 4: 結果発表（スマホ対応、戦車隊ボーナス表示）

- 🗄️ **Supabaseデータベース設計完了**
  - `monthly_tournaments` テーブル
  - `player_monthly_stats` テーブル
  - `daily_attack_limits` テーブル
  - `battle_matches` テーブル
  - `match_history` テーブル
  - 全テーブルにRLSポリシー設定
  - インデックス作成

- 🛡️ **管理者機能の基盤構築**
  - `admin_roles` テーブル
  - `admin_logs` テーブル
  - `system_settings` テーブル
  - 管理者チェック関数（`is_admin()`, `is_super_admin()`）

- ⚙️ **Supabase関数実装**
  - `get_jst_date()` - JST日付取得
  - `get_active_tournament()` - アクティブトーナメント取得
  - `initialize_player_for_tournament()` - プレイヤー初期化
  - `get_player_tournament_data()` - プレイヤーデータ取得
  - `increment_daily_attacks()` - 攻撃回数インクリメント
  - `can_attack_today()` - 攻撃可能チェック

- 🏠 **石高トーナメント ダッシュボード実装**
  - 宝物庫（賞金総額）表示
  - 今月の消費P表示
  - ランキングTOP5表示
  - 全体の対戦履歴表示
  - 3つのゲーム選択カード（壱之陣、弐之陣、参之陣）
  - ルール説明モーダル（各ゲームの詳細説明、ワクワクする文言）

- 📚 **ドキュメント整備**
  - `KOKU_TOURNAMENT_STRUCTURE.md` - プロジェクト構造
  - `TROUBLESHOOTING.md` - トラブルシューティング
  - `API_DOCS.md` - API仕様書
  - `CHANGELOG.md` - 変更履歴

### Changed
- 和風ネオンデザインの色分けルール統一
  - 敵軍: 足軽（青）、騎馬（緑）、鉄砲（赤）
  - 味方: 足軽（赤）、騎馬（緑）、鉄砲（青）、戦車（金）
- スマホ対応を全Phase統一
  - max-w-md（448px）
  - コンパクトなフォントサイズ
  - 適切なパディング・余白

### Fixed
- Phase 3で勝敗判定が逆になる問題を修正
- 戦車隊の999が表示されない問題を修正
- Phase間のデータ引き継ぎが不完全だった問題を修正
- useStateの配列分割代入エラーを修正

---

## [0.2.0] - 2025-10-XX

### Added
- 📸 **写真シェア機能**
  - ギャンブル写真投稿機能
  - 写真ギャラリー表示
  - お気に入りゲームタグ
  - ランダム表示機能

- 🏆 **殿堂入り機能**
  - 大勝ちトップ10
  - 大負けトップ10
  - 感情アイコン表示
  - コメント付き

- 📊 **みんなのオールギャンブルデータ**
  - 全ユーザーのランキング表示
  - 総収支、勝率、プレイ回数
  - カテゴリ別フィルタ

### Changed
- オールギャンブルコミュニティのデザイン刷新
  - ゴールドネオンカラー採用
  - タブナビゲーション追加

### Fixed
- 写真が全面表示されない問題を修正（`object-cover` → `object-contain`）
- スマホ表示で入力欄がはみ出る問題を修正

---

## [0.1.0] - 2025-09-XX

### Added
- 🎴 **基本機能実装**
  - ユーザー認証（Supabase Auth）
  - プロフィール管理
  - ホームゲームポーカー記録
  - オールギャンブル記録
  - P-BANK管理

- 📚 **レッスン機能**
  - テキサスホールデムレッスン
  - バカラレッスン
  - 投資法シミュレーター

- 🎨 **UIデザイン**
  - サイバーパンク × ラグジュアリーカジノ
  - Purple/Pink グラデーション
  - ネオンエフェクト
  - グリッチアニメーション

### Changed
- データベース構造最適化
  - `gamble_records` と `game_sessions` の分離
  - RLSポリシーの最適化

---

## 🐛 既知の問題

### 優先度: 高
- [ ] Phase 1から相手選択画面の遷移が未実装
- [ ] Supabaseへのデータ記録が未実装（Phase 4完了後）
- [ ] ランキング詳細画面が未実装
- [ ] 履歴詳細画面が未実装

### 優先度: 中
- [ ] 管理者ダッシュボードが未実装
- [ ] プレイヤー検索機能が未実装
- [ ] リアルタイム更新が未実装

### 優先度: 低
- [ ] 弐之陣・参之陣が未実装
- [ ] パフォーマンス最適化が必要
- [ ] アクセシビリティ対応が不十分

---

## 📋 今後の予定

### v0.4.0（2025-10月下旬予定）
- [ ] 壱之陣のSupabase統合完了
- [ ] 相手選択画面実装
- [ ] ランキング・履歴詳細画面実装
- [ ] 管理者ダッシュボード基本機能

### v0.5.0（2025-11月予定）
- [ ] 弐之陣「城攻め」完全実装
- [ ] 参之陣「一騎討ち」完全実装
- [ ] リアルタイム通知機能

### v1.0.0（2025-12月予定）
- [ ] 全機能実装完了
- [ ] パフォーマンス最適化
- [ ] 本番環境デプロイ
- [ ] 初回トーナメント開催

---

## 🔧 技術的な変更

### データベース
- **2025-10-14**: タイムゾーンをAsia/Tokyo（JST）に統一
- **2025-10-14**: `rank_timestamp` トリガー追加（同値時の順位決定用）
- **2025-10-14**: 日次攻撃制限テーブル追加

### API
- **2025-10-14**: API設計完了（API_DOCS.md参照）

### UI/UX
- **2025-10-14**: スマホファースト対応（max-w-md統一）
- **2025-10-14**: 和風ネオンデザイン確立

---

## 👥 貢献者

- **メイン開発**: あなた
- **AI支援**: Claude (Anthropic)

---

## 📞 サポート・フィードバック

バグ報告や機能提案は以下で受け付けています：

- GitHub Issues（準備中）
- Discord（準備中）
- メール（準備中）

---

**凡例**
- 🎮 ゲーム機能
- 🗄️ データベース
- 🛡️ セキュリティ
- ⚙️ 関数・ロジック
- 🏠 UI/UX
- 📚 ドキュメント
- 📸 メディア
- 🏆 ランキング
- 📊 統計
- 🐛 バグ修正
- ⚡ パフォーマンス

---

**最終更新日**: 2025年10月14日  
**現在のバージョン**: 0.3.0